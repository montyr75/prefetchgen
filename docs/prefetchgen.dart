import "dart:io";const TB='mangledGlobalNames';const String i="prefetch.html";final List<String> s=const<String>[".jpg",".jpeg",".png",".gif",".webp",".tif",".tiff",".jp2",".jpx",".j2k",".j2c"];void main(){StringBuffer B=new StringBuffer();StringBuffer C=new StringBuffer();Directory D=Directory.current;List<FileSystemEntity> Q=D.listSync(recursive:true,followLinks:false);List<FileSystemEntity> Y=Q.where((FileSystemEntity G)=>G is File&&s.contains(v(G.path))).toList();List<String> A=Y.map((File d)=>d.path.split("${D.path}\\").last.replaceAll(r"\",r"/")).toList();print("Found ${A!=null?A.length:0} images...");if(A!=null&&A.length>0){for(String I in A){B.writeln("  ${I}");C.writeln('<link rel="prefetch" href="${I}"/>');}B.writeln();stdout.write("${B.toString()}");new File(i).writeAsString(C.toString()).then((r)=>stdout.writeln("${i} created.")).catchError((){exitCode=2;stdout.writeln("Error writing file.");});}}final a t=KB();String get u{var C=Uri.base;if(J.j==J.f){return C.resolve('.').toString();}else{var A=C.toFilePath();int B=A.length-1;assert(A[B]=='/'||A[B]=='\\');return A.substring(0,B);}}String v(String A)=>t.h(A);const AB=0x2b;const BB=0x2d;const CB=0x2e;const e=0x2f;const DB=0x30;const EB=0x39;const FB=0x3a;const GB=0x41;const HB=0x5a;const IB=0x61;const JB=0x7a;const Z=0x5c;a KB()=>new a.UB();class a{a.UB():L=J.j,XB=null;final R L;final String XB;String get current=>XB!=null?XB:u;String get N=>L.N;String h(String A)=>YB(A).h;String SB(String B){var A=YB(B).K;return A==null?'':A;}bool isAbsolute(String A)=>YB(A).isAbsolute;bool W(String A)=>YB(A).W;String join(String B,[String C,String D,String G,String I,String Q,String Y,String d]){var A=[B,C,D,G,I,Q,Y,d];LB("join",A);return RB(A.where((r)=>r!=null));}String RB(Iterable<String> I){var B=new StringBuffer();var D=false;var G=false;for(var A in I.where((A)=>A!='')){if(this.W(A)&&G){var C=YB(A);C.K=this.SB(B.toString());if(L.X(C.K)){C.P[0]=L.N;}B.clear();B.write(C.toString());}else if(this.isAbsolute(A)){G=!this.W(A);B.clear();B.write(A);}else{if(A.length>0&&L.c(A[0])){}else if(D){B.write(N);}B.write(A);}D=L.X(A);}return B.toString();}List<String> split(String B){var A=YB(B);A.M=A.M.where((C)=>!C.isEmpty).toList();if(A.K!=null)A.M.insert(0,A.K);return A.M;}U YB(String A)=>new U.VB(A,L);}LB(String I,List<String> A){for(var B=1;B<A.length;B++ ){if(A[B]==null||A[B-1]!=null)continue;var C;for(C=A.length;C>=1;C-- ){if(A[C-1]!=null)break;}var D=new StringBuffer();D.write("${I}(");D.write(A.take(C).map((G)=>G==null?"null":'"${G}"').join(", "));D.write("): part ${B-1} was null, but part ${B} was not.");throw new ArgumentError(D.toString());}}abstract class R extends J{String get N;bool c(String A);bool H(int A);bool X(String A);String V(String A);String O(String A);}class U{R L;String K;bool W;List<String> M;List<String> P;String get h=>ZB()[1];bool get isAbsolute=>K!=null;factory U.VB(String A,R D){var d=A;var I=D.V(A);var Y=D.O(A)!=null;if(I!=null)A=A.substring(I.length);var Q=[] ;var G=[] ;var B=0;if(A.isNotEmpty&&D.H(A.codeUnitAt(0))){G.add(A[0]);B=1;}else{G.add('');}for(var C=B;C<A.length;C++ ){if(D.H(A.codeUnitAt(C))){Q.add(A.substring(B,C));G.add(A[C]);B=C+1;}}if(B<A.length){Q.add(A.substring(B));G.add('');}return new U.WB(D,I,Y,Q,G);}U.WB(this.L,this.K,this.W,this.M,this.P);String toString(){var A=new StringBuffer();if(K!=null)A.write(K);for(var B=0;B<M.length;B++ ){A.write(P[B]);A.write(M[B]);}A.write(P.last);return A.toString();}List<String> ZB(){var A=M.lastWhere((C)=>C!='',orElse:()=>null);if(A==null)return ['',''];if(A=='..')return ['..',''];var B=A.lastIndexOf('.');if(B<=0)return [A,''];return [A.substring(0,B),A.substring(B)];}}abstract class J{static final MB=new k();static final NB=new m();static final f=new l();static final j=OB();static J OB(){if(Uri.base.scheme!='file')return J.f;if(!Uri.base.path.endsWith('/'))return J.f;if(new Uri(path:'a/b').toFilePath()=='a\\b')return J.NB;return J.MB;}String get name;String get N;String V(String A);String O(String A);String toString()=>name;}class k extends R{k();final name='posix';final N='/';final P=const['/'];final q=new RegExp(r'/');final n=new RegExp(r'[^/]$');final p=new RegExp(r'^/');final o=null;bool c(String A)=>A.contains('/');bool H(int A)=>A==e;bool X(String A)=>A.isNotEmpty&&!H(A.codeUnitAt(A.length-1));String V(String A){if(A.isNotEmpty&&H(A.codeUnitAt(0)))return '/';return null;}String O(String A)=>null;}class l extends R{l();final name='url';final N='/';final P=const['/'];final q=new RegExp(r'/');final n=new RegExp(r"(^[a-zA-Z][-+.a-zA-Z\d]*://|[^/])$");final p=new RegExp(r"[a-zA-Z][-+.a-zA-Z\d]*://[^/]*");final o=new RegExp(r"^/");bool c(String A)=>A.contains('/');bool H(int A)=>A==e;bool X(String A){if(A.isEmpty)return false;if(!H(A.codeUnitAt(A.length-1)))return true;var B=aB(A);return B!=null&&B.endsWith('://');}String V(String A){var B=aB(A);return B==null?O(A):B;}String O(String A){if(A.isEmpty)return null;return H(A.codeUnitAt(0))?"/":null;}String aB(String B){if(B.isEmpty)return null;if(!g(B.codeUnitAt(0)))return null;var A=1;for(;A<B.length;A++ ){var C=B.codeUnitAt(A);if(g(C))continue;if(PB(C))continue;if(C==BB||C==AB||C==CB){continue;}break;}if(A+3>B.length)return null;if(B.substring(A,A+3)!='://')return null;A+= 3;while(A<B.length&&!H(B.codeUnitAt(A))){A++ ;}return B.substring(0,A);}}class m extends R{m();final name='windows';final N='\\';final P=const['/','\\'];final q=new RegExp(r'[/\\]');final n=new RegExp(r'[^/\\]$');final p=new RegExp(r'^(\\\\[^\\]+\\[^\\/]+|[a-zA-Z]:[/\\])');final o=new RegExp(r"^[/\\](?![/\\])");bool c(String A)=>A.contains('/');bool H(int A)=>A==e||A==Z;bool X(String A){if(A.isEmpty)return false;return !H(A.codeUnitAt(A.length-1));}String V(String A){var B=bB(A);return B==null?O(A):B;}String O(String A){if(A.isEmpty)return null;if(!H(A.codeUnitAt(0)))return null;if(A.length>1&&H(A.codeUnitAt(1)))return null;return A[0];}String bB(String A){if(A.length<3)return null;if(g(A.codeUnitAt(0))){if(A.codeUnitAt(1)!=FB)return null;if(!H(A.codeUnitAt(2)))return null;return A.substring(0,3);}if(!A.startsWith('\\\\'))return null;var B=2;while(B<A.length&&A.codeUnitAt(B)!=Z){B++ ;}if(B==2||B==A.length)return null;B+= 1;if(A.codeUnitAt(B)==Z)return null;B+= 1;while(B<A.length&&A.codeUnitAt(B)!=Z){B++ ;}return A.substring(0,B);}}bool g(int A)=>(A>=GB&&A<=HB)||(A>=IB&&A<=JB);bool PB(int A)=>A>=DB&&A<=EB;